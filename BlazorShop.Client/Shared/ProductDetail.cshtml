@using BlazorShop.Shared.Models
@using BlazorShop.Client.Services;
@inject IDataService DataService

@if (ShowOverlay)
{
    <div class="overlay">
        <div class="overlay-content">
            <div class="closebtn" onclick="@(_ => ShowOverlay = false)" title="Close Overlay">x</div>
            <div class="product-info">
                @if (Product != null)
                {
                    <p>Title</p>
                    <p>@Product.Title</p>

                    <p>Description</p>
                    <p>@Product.HtmlDescription</p>
                }
                else
                {
                    <p>Error loading Product with Id @ProductId</p>
                }
            </div>
        </div>
    </div>
}

@functions{
    [Parameter]
    private int ProductId { get; set; }
    [Parameter]
    private Action<int> ProductIdChanged { get; set; }

    private bool ShowOverlay { get; set; }
    private Product Product { get; set; }

    private int LastId { get; set; }

    protected async override Task OnParametersSetAsync()
    {
        if (ProductId != 0)
        {
            if (ProductId != LastId)
            {
                Product = await DataService.GetProductDetails(ProductId);
            }
            ShowOverlay = true;
            LastId = ProductId;
        }
    }
}